<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atividade do Restaurante: Jogo das Receitas</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f4f9; /* Fundo neutro */
        }

        #app-container {
            /* O CONTAINER PRINCIPAL DO JOGO */
            background-color: #fff;
            border: 2px solid #333;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            text-align: center;
            width: 800px;
            max-width: 90%;
        }

        /* --- Estilo da Tela de Login --- */
        #login-screen {
            padding: 40px 20px;
        }

        #login-screen h1 {
            color: #4CAF50;
            margin-bottom: 30px;
        }

        #login-form input {
            padding: 10px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            width: 250px;
        }

        #login-form button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
            transition: background-color 0.3s;
        }

        /* --- Estilos da Tela do Jogo (FUNDO GIF) --- */
        #game-screen {
            display: none; /* Esconde a tela do jogo inicialmente */
            
            /* --- IN√çCIO: FUNDO DE COZINHA GIF --- */
            background-image: url('https://i.imgur.com/qKjBc1w.gif');
            background-size: cover;
            background-position: center bottom; /* Ajustado para melhor visualiza√ß√£o do fog√£o */
            padding: 20px;
            border-radius: 8px;
            /* Garante que o texto seja leg√≠vel sobre o fundo da imagem */
            color: white; /* Cor da fonte branca para contraste com o fundo escuro */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            /* FIM: FUNDO DE COZINHA GIF */
        }
        
        #game-screen h1 {
            color: white;
            text-shadow: 2px 2px 3px black;
        }

        #stove-area {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            position: relative;
            height: 300px; /* Altura para posicionar a panela na parte de cima */
        }
        
        /* --- ESTILOS DA PANELA (IMAGEM E ZONA DE DROP) --- */
        #pot-dropzone {
            /* Posiciona a zona de drop sobre o fog√£o (parte de cima do stove-area) */
            position: absolute;
            top: 20px; /* Ajuste vertical para alinhar com o GIF */
            width: 200px;
            height: 200px; 
            
            /* Imagem da Panela como Fundo */
            background-image: url('https://i.imgur.com/yzVztQL.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            
            /* Torna a √°rea de drop invis√≠vel, mas interativa */
            background-color: transparent;
            border: 2px dashed rgba(255, 255, 255, 0.5); /* Borda para demarcar a √°rea de drop (pode ser removida) */
            border-radius: 50%; /* Tenta simular a forma da panela */
            
            color: rgba(255, 255, 255, 0.8);
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        #pot-dropzone p {
            margin: 0;
            font-size: 14px;
        }

        #current-ingredients {
            min-height: 50px;
            width: 100%;
            margin-top: 5px;
            padding: 5px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            /* Fundo transparente para os ingredientes na panela */
            background-color: rgba(0, 0, 0, 0.3); 
            border-radius: 5px;
        }

        #ingredients-area {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.85); /* Fundo claro para ingredientes */
            color: black;
            text-shadow: none;
        }

        .ingredient {
            cursor: grab;
            padding: 8px 12px;
            background-color: #7fffd4;
            border: 1px solid #3cb371;
            border-radius: 5px;
            font-size: 14px;
            transition: transform 0.1s ease-in-out;
        }

        .ingredient-in-pot {
            background-color: #ff9800;
            color: white;
            padding: 4px 6px;
            border-radius: 3px;
            font-size: 12px;
        }

        .highlight {
            border: 3px dashed yellow !important; /* Destaque amarelo ao arrastar */
        }

        button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
            transition: background-color 0.3s;
        }

        button:hover:enabled {
            background-color: #45a049;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        #clear-pot-button {
            background-color: #f44336;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div id="app-container">
        <div id="login-screen">
            <h1>Atividade do Restaurante: Jogo das Receitas</h1>
            <p>Insira seu Nickname para come√ßar o desafio!</p>
            <div id="login-form">
                <input type="text" id="nickname-input" placeholder="Seu Nickname" maxlength="15">
                <button id="start-game-button" disabled>Come√ßar</button>
            </div>
            <p id="player-status-message" style="color: blue; margin-top: 15px;"></p>
        </div>

        <div id="game-screen">
            <h1>Mini-Jogo: Chef em A√ß√£o</h1>
            <p id="status-text">Arraste os ingredientes para a panela e complete 3 receitas!</p>
            <p id="recipe-counter">Receitas Completas: 0/3</p>

            <div id="stove-area">
                <div id="pot-dropzone">
                    <p>SOLTE OS INGREDIENTES AQUI</p>
                    <div id="current-ingredients"></div>
                </div>
            </div>

            <div id="ingredients-area">
                </div>

            <button id="check-recipe-button" disabled>Verificar Receita</button>
            <button id="clear-pot-button">Limpar Panela</button>

            <audio id="drop-sound" src="ding.mp3" preload="auto"></audio>
        </div>
    </div>

    <script>
        // Substitua APENAS estes dados pela sua configura√ß√£o do Firebase da imagem
        const firebaseConfig = {
            apiKey: "AIzaSyD0f60PyH7r2b13Py4DbDixudkb1GJam5BA",
            authDomain: "jogoreceitas-3a179.firebaseapp.com",
            projectId: "jogoreceitas-3a179",
            storageBucket: "jogoreceitas-3a179.firebaseapp.com",
            messagingSenderId: "806274352483",
            appId: "1:806274352483:web:b930a2822d70c55c83f56",
            measurementId: "G-E7QFS3E77C"
        };

        // Inicializa o Firebase e o Firestore
        const app = firebase.initializeApp(firebaseConfig);
        const db = app.firestore();
        
        // --- DADOS DO JOGO (Regras) ---
        const ALL_RECIPES = {
            'bolo_chocolate': { name: 'Bolo de Chocolate', ingredients: ['Ovos', 'Leite', 'Trigo', 'Chocolate', 'Fermento', 'A√ß√∫car'] },
            'bife_pure': { name: 'Bife com Pur√™', ingredients: ['Bife', 'Pur√™ de batata'] },
            'sanduiche': { name: 'Sandu√≠che Natural', ingredients: ['P√£o', 'Queijo', 'Presunto'] },
            'macarrao_almondegas': { name: 'Macarr√£o c/ Alm√¥ndegas', ingredients: ['Macarr√£o', 'Molho de tomate', 'Alm√¥ndegas'] },
            'prato_feito': { name: 'Prato Feito (PF)', ingredients: ['Arroz', 'Feij√£o', 'Bife'] }
        };

        const ALL_INGREDIENTS = [
            'Macarr√£o', 'Molho de tomate', 'Alface', 'Cebola', 'Ma√ß√£', 'Ovos', 'Leite',
            'Chocolate', 'Trigo', 'Fermento', 'A√ß√∫car', 'P√£o', 'Queijo', 'Presunto',
            'Bacon', 'Bife', 'Pur√™ de batata', 'Batata fritas', 'Arroz', 'Feij√£o', 'Alm√¥ndegas'
        ];

        // --- VARI√ÅVEIS DE ESTADO ---
        let playerName = null;
        let ingredientsInPot = [];
        let recipesCompleted = [];
        let gameWon = false;
        const WIN_COUNT = 3;

        // --- ELEMENTOS DO DOM ---
        const loginScreen = document.getElementById('login-screen');
        const gameScreen = document.getElementById('game-screen');
        const nicknameInput = document.getElementById('nickname-input');
        const startGameButton = document.getElementById('start-game-button');
        const playerStatusMessage = document.getElementById('player-status-message');
        
        const potDropzone = document.getElementById('pot-dropzone');
        const ingredientsArea = document.getElementById('ingredients-area');
        const currentIngredientsDiv = document.getElementById('current-ingredients');
        const statusText = document.getElementById('status-text');
        const recipeCounter = document.getElementById('recipe-counter');
        const checkRecipeButton = document.getElementById('check-recipe-button');
        const clearPotButton = document.getElementById('clear-pot-button');
        const dropSound = document.getElementById('drop-sound');

        // --- L√ìGICA DE LOGIN/INICIALIZA√á√ÉO ---

        nicknameInput.addEventListener('input', () => {
            startGameButton.disabled = nicknameInput.value.trim().length === 0;
        });

        startGameButton.addEventListener('click', async () => {
            playerName = nicknameInput.value.trim();
            if (playerName) {
                // Tenta carregar o progresso existente ou cria um novo
                await loadPlayerProgress(playerName);
                loginScreen.style.display = 'none';
                gameScreen.style.display = 'block';
                statusText.textContent = `Ol√°, Chef ${playerName}! Fa√ßa ${WIN_COUNT} receitas!`;
                initializeGame();
            }
        });

        /**
         * Carrega o progresso do jogador do Firebase ou inicializa.
         */
        async function loadPlayerProgress(nick) {
            try {
                const docRef = db.collection('jogadores').doc(nick);
                const doc = await docRef.get();

                if (doc.exists) {
                    const data = doc.data();
                    recipesCompleted = data.recipesCompleted || [];
                    playerStatusMessage.textContent = `Progresso de ${nick} carregado. Receitas feitas: ${recipesCompleted.length}.`;
                } else {
                    // Novo jogador, cria o documento
                    await docRef.set({
                        nick: nick,
                        recipesCompleted: [],
                        lastPlayed: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    recipesCompleted = [];
                    playerStatusMessage.textContent = `Novo jogador ${nick} registrado.`;
                }
            } catch (error) {
                console.error("Erro ao carregar/salvar progresso no Firebase:", error);
                playerStatusMessage.textContent = "Erro de conex√£o com o Firebase. O progresso n√£o ser√° salvo.";
            }
        }

        // --- L√ìGICA DE JOGO ---

        /**
         * Normaliza e compara duas listas de ingredientes.
         */
        function areListsEqual(list1, list2) {
            if (list1.length !== list2.length) return false;
            const sorted1 = [...list1].sort();
            const sorted2 = [...list2].sort();
            return sorted1.every((value, index) => value === sorted2[index]);
        }

        /**
         * Verifica se os ingredientes na panela formam uma receita.
         */
        async function checkRecipe() {
            if (gameWon) return;

            const currentCombo = [...ingredientsInPot];
            let foundRecipeId = null;
            let foundRecipeName = null;

            for (const [id, recipe] of Object.entries(ALL_RECIPES)) {
                if (recipesCompleted.includes(id)) {
                    continue; // Pula receitas j√° feitas
                }

                if (areListsEqual(currentCombo, recipe.ingredients)) {
                    foundRecipeId = id;
                    foundRecipeName = recipe.name;
                    break;
                }
            }

            if (foundRecipeId) {
                // Receita encontrada!
                recipesCompleted.push(foundRecipeId);
                statusText.textContent = `PARAB√âNS! Voc√™ fez um(a) ${foundRecipeName}!`;
                
                // Limpa a panela e reseta o estado local
                ingredientsInPot = [];
                updatePotDisplay();

                // L√≥gica de Persist√™ncia no Firebase
                await saveProgressToFirebase();
                
                // L√≥gica de Vit√≥ria
                updateGameDisplay();
                if (recipesCompleted.length >= WIN_COUNT) {
                    gameWon = true;
                    statusText.textContent = `VIT√ìRIA! Voc√™ completou ${recipesCompleted.length} receitas e venceu o jogo! Parab√©ns, Chef ${playerName}!`;
                    checkRecipeButton.disabled = true;
                    ingredientsArea.innerHTML = '<h2>üéâ JOGO COMPLETO! üéâ</h2>';
                }

            } else {
                statusText.textContent = `Essa combina√ß√£o (${currentCombo.join(', ')}) n√£o resulta em uma receita nova. Tente limpar e come√ßar de novo.`;
            }
        }

        /**
         * Salva o progresso do jogador no Firebase.
         */
        async function saveProgressToFirebase() {
            if (!playerName) return;
            try {
                await db.collection('jogadores').doc(playerName).update({
                    recipesCompleted: recipesCompleted,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error("Erro ao salvar progresso no Firebase:", error);
            }
        }

        /**
         * Adiciona um ingrediente √† panela.
         */
        function addIngredientToPot(ingredientName) {
            if (gameWon) return;
            
            if (ingredientsInPot.includes(ingredientName)) {
                statusText.textContent = `${ingredientName} j√° est√° na panela!`;
                return;
            }

            ingredientsInPot.push(ingredientName);
            dropSound.currentTime = 0;
            dropSound.play();
            updatePotDisplay();
            statusText.textContent = `${ingredientName} adicionado.`;
        }

        /**
         * Atualiza o contador de receitas e o status geral.
         */
        function updateGameDisplay() {
            recipeCounter.textContent = `Receitas Completas: ${recipesCompleted.length}/${WIN_COUNT}`;
        }

        /**
         * Limpa todos os ingredientes da panela.
         */
        function clearPot() {
            ingredientsInPot = [];
            updatePotDisplay();
            statusText.textContent = 'Panela limpa. Comece uma nova receita!';
        }

        // --- L√ìGICA DO DRAG-AND-DROP ---

        function dragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.textContent);
            e.target.style.opacity = '0.5';
        }

        function dragEnd(e) {
            e.target.style.opacity = '1';
        }

        function dragOver(e) {
            e.preventDefault();
        }

        function dragEnter(e) {
            if (e.target.closest('#pot-dropzone')) {
                potDropzone.classList.add('highlight');
            }
        }

        function dragLeave(e) {
            if (e.target.closest('#pot-dropzone')) {
                potDropzone.classList.remove('highlight');
            }
        }

        function drop(e) {
            e.preventDefault();
            potDropzone.classList.remove('highlight');
            
            const ingredientName = e.dataTransfer.getData('text/plain');
            
            addIngredientToPot(ingredientName);
        }

        // --- INICIALIZA√á√ÉO DO JOGO ---

        function initializeIngredients() {
            ingredientsArea.innerHTML = '';
            ALL_INGREDIENTS.forEach(ing => {
                const div = document.createElement('div');
                div.textContent = ing;
                div.className = 'ingredient';
                div.setAttribute('draggable', true);
                div.addEventListener('dragstart', dragStart);
                div.addEventListener('dragend', dragEnd);
                ingredientsArea.appendChild(div);
            });
        }

        function attachListeners() {
            potDropzone.addEventListener('dragover', dragOver);
            potDropzone.addEventListener('dragenter', dragEnter);
            potDropzone.addEventListener('dragleave', dragLeave);
            potDropzone.addEventListener('drop', drop);

            checkRecipeButton.addEventListener('click', checkRecipe);
            clearPotButton.addEventListener('click', clearPot);
        }

        function initializeGame() {
            initializeIngredients();
            attachListeners();
            updateGameDisplay();
            updatePotDisplay();
        }

    </script>
</body>
</html>
